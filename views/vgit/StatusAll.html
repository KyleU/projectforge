{% import (
  "github.com/kyleu/projectforge/app"
  "github.com/kyleu/projectforge/app/action"
  "github.com/kyleu/projectforge/app/git"
  "github.com/kyleu/projectforge/app/controller/cutil"
  "github.com/kyleu/projectforge/views/components"
  "github.com/kyleu/projectforge/views/layout"
) %}

{% code type StatusAll struct {
  layout.Basic
  Statuses git.Statuses
} %}

{% func (p *StatusAll) Body(as *app.State, ps *cutil.PageState) %}
  <div class="card">
    <h3>Source Control</h3>
    <div class="mt">
      <a href="/run/{%s action.TypePreview.Key %}" title="{%s action.TypePreview.Description %}"><button>{%s action.TypePreview.Title %}</button></a>
      <a href="/git" title="Build status for all projects"><button>Status</button></a>
      <a href="/git/all/magic" title="Runs the magic for all projects"><button>Magic</button></a>
    </div>
    <div class="mt">
      <ul class="accordion">
        {%- for _, x := range p.Statuses -%}
        <li>
          <input id="accordion-{%s x.Project.Key %}" type="checkbox" hidden />
          <label for="accordion-{%s x.Project.Key %}">
            <em class="right">{%s x.Status() %}{% if x.Error != "" %} (error){% endif %}</em>
            {%= components.ExpandCollapse(3, ps) %} {%= components.SVGRef(x.Project.IconSafe(), 16, 16, "icon", ps) %}
            {%s x.Project.Title() %}
            <em>({%s x.Branch %})</em>
          </label>
          <div class="bd">
            {%= statusActions(x) %}
            {%= statusDetail(x) %}
          </div>
        </li>
        {%- endfor -%}
      </ul>
    </div>
  </div>
{% endfunc %}
