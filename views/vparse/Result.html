{% import (
  "projectforge.dev/projectforge/app"
  "projectforge.dev/projectforge/app/controller/cutil"
  "projectforge.dev/projectforge/app/project/export/datschema"
  "projectforge.dev/projectforge/views/components"
  "projectforge.dev/projectforge/views/layout"
) %}

{% code type Result struct {
  layout.Basic
  Schema *datschema.Schema
} %}

{% func (p *Result) Body(as *app.State, ps *cutil.PageState) %}
  <div class="card">
    <h3>{%= components.SVGRefIcon(`cog`, ps) %}Parse Result</h3>
    <div class="overflow full-width">
      <table class="mt min-200">
        <tbody>
          <tr>
            <th class="shrink">Version</th>
            <td>{%d p.Schema.Version %}</td>
          </tr>
          <tr>
            <th>Created At</th>
            <td>{%d p.Schema.CreatedAt %}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="card">
    <h3>{%= components.SVGRefIcon(`cog`, ps) %}Tables</h3>
    <ul class="accordion">
      {%- for _, t := range p.Schema.Tables -%}
      <li>
        <input id="table-{%s t.Name %}" type="checkbox" hidden />
        <label for="table-{%s t.Name %}">
          {%= components.ExpandCollapse(3, ps) %}{%s t.Name %}
        </label>
        <div class="bd">
          <div class="wrapper">
            <div class="padded">
              {%= renderTable(t, ps) %}
            </div>
          </div>
        </div>
      </li>
      {%- endfor -%}
    </ul>
  </div>
  <div class="card">
    <h3>{%= components.SVGRefIcon(`cog`, ps) %}Enums</h3>
    <ul class="accordion">
      {%- for _, e := range p.Schema.Enumerations -%}
      <li>
        <input id="enum-{%s e.Name %}" type="checkbox" hidden />
        <label for="enum-{%s e.Name %}">
          {%= components.ExpandCollapse(3, ps) %}{%s e.Name %}
        </label>
        <div class="bd">
          <div class="wrapper">
            <div class="padded">
              {%= renderEnum(e, ps) %}
            </div>
          </div>
        </div>
      </li>
      {%- endfor -%}
    </ul>
  </div>
{% endfunc %}

{% func renderTable(t *datschema.Table, ps *cutil.PageState) %}
  <ul class="accordion">
    <li>
      <input id="table-{%s t.Name %}-columns" type="checkbox" hidden />
      <label for="table-{%s t.Name %}-columns">
        {%= components.ExpandCollapse(3, ps) %} {%d len(t.Columns) %} Columns
      </label>
      <div class="bd">
        <div class="wrapper">
          <div class="padded">
            <table class="min-200">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Description</th>
                  <th>Array</th>
                  <th>Type</th>
                  <th>Unique</th>
                  <th>Localized</th>
                  <th>References</th>
                  <th>Until</th>
                  <th>File</th>
                  <th>Files</th>
                </tr>
              </thead>
              <tbody>
                {%- for _, col := range t.Columns -%}
                <tr>
                  <td>{%s col.SafeName() %}</td>
                  <td>{%s col.Description %}</td>
                  <td>{%v col.Array %}</td>
                  <td>{%s col.Type %}</td>
                  <td>{%v col.Unique %}</td>
                  <td>{%v col.Localized %}</td>
                  <td>{%v col.References %}</td>
                  <td>{%v col.Until %}</td>
                  <td>{%v col.File %}</td>
                  <td>{%v col.Files %}</td>
                </tr>
                {%- endfor -%}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </li>
  </ul>
{% endfunc %}

{% func renderEnum(e *datschema.Enumeration, ps *cutil.PageState) %}
  <ul class="accordion">
    <li>
      <input id="table-{%s e.Name %}-enums" type="checkbox" hidden />
      <label for="table-{%s e.Name %}-enums">
        {%= components.ExpandCollapse(3, ps) %} {%d len(e.Enumerators) %} Values
      </label>
      <div class="bd">
        <div class="wrapper">
          <div class="padded">
            <table class="min-200">
              <thead>
                <tr>
                  <th>Name</th>
                </tr>
              </thead>
              <tbody>
                {%- for _, x := range e.Enumerators -%}
                <tr>
                  <td>{%s x %}</td>
                </tr>
                {%- endfor -%}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </li>
  </ul>
{% endfunc %}
