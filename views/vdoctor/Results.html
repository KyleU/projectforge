<!-- Code generated by Project Forge, see https://projectforge.dev for details. -->
{% import (
  "github.com/kyleu/projectforge/app"
  "github.com/kyleu/projectforge/app/controller/cutil"
  "github.com/kyleu/projectforge/app/doctor"
  "github.com/kyleu/projectforge/app/util"
  "github.com/kyleu/projectforge/views/components"
  "github.com/kyleu/projectforge/views/layout"
) %}

{% code type Results struct {
  layout.Basic
  Results doctor.Results
} %}

{% func (p *Results) Body(as *app.State, ps *cutil.PageState) %}
  <div class="card">
    <h3>Doctor Results</h3>

    <ul class="accordion">
      {%- for _, r := range p.Results -%}
      <li>
        <input id="accordion-{%s r.Key %}" type="checkbox" hidden {% if len(p.Results) == 1 || len(r.Errors) > 0 %} checked="checked"{% endif %}/>
        <label for="accordion-{%s r.Key %}">
          <div class="right">{%s r.Status %}</div>
          {%= components.ExpandCollapse(3, ps) %} {%s r.Title %}
        </label>
        <div class="bd">
          <div class="right">{%s util.MicrosToMillis(r.Duration) %}</div>
          <em>{%s r.Summary %}</em>
          {%- if len(r.Errors) == 0 -%}
          <div>{%s r.Status %}, no errors</div>
          {%- else -%}
          <h4>Errors</h4>
          <ul>
            {%- for _, e := range r.Errors -%}
            <li>{%s e.String() %}</li>
            {%- endfor -%}
          </ul>
          {%- endif -%}
        </div>
      </li>
      {%- endfor -%}
    </ul>
  </div>
{% endfunc %}
